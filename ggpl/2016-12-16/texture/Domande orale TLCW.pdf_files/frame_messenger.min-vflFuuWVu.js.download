var FrameMessenger,bind=function(t,r){return function(){return t.apply(r,arguments)}},indexOf=[].indexOf||function(t){for(var r=0,e=this.length;e>r;r++)if(r in this&&this[r]===t)return r;return-1};FrameMessenger=function(){function t(){this.handleUntrustedMessage=bind(this.handleUntrustedMessage,this),Object.defineProperty(this,"trustedParentOriginForPosting",{get:function(){return this._trustedParentOriginForPosting}}),Object.defineProperty(this,"trustedChildOriginForPosting",{get:function(){var t,r,e,i,n;if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(t=document.querySelectorAll(this._childIframeQuery),r=0,n=t.length;n>r&&(e=t[r],i=e.getAttribute("src"),!this._validateChildOriginForPosting(i));r++);return this._trustedChildOriginForPosting}})}return t._ALLOWED_CHILD_ORIGINS=["https://www.dropboxstatic.com","https://www.dropboxstatic.com:443","https://cf.dropboxstatic.com","https://cf.dropboxstatic.com:443","https://cfl.dropboxstatic.com","https://cfl.dropboxstatic.com:443","https://www.dropbox.com","https://www.dropbox.com:443","https://dl-doc.dropbox.com","https://dl-doc.dropbox.com:443","https://dl-web.dropbox.com","https://dl-web.dropbox.com:443","https://dl.dropboxusercontent.com","https://dl.dropboxusercontent.com:443","null"],t._ALLOWED_PARENT_ORIGINS=["https://www.dropbox.com","https://www.dropbox.com:443"],t._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,t.prototype._childIframeQuery=null,t.prototype._trustedChildOriginForPosting=null,t.prototype._trustedParentOriginForPosting=null,t.prototype._validActionsFromChild=[],t.prototype._validActionsFromParent=[],t.prototype._trustedMessageFromChildHandler=null,t.prototype._trustedMessageFromParentHandler=null,t.prototype._parentMessageQueue=[],t.prototype._requestParentOriginPollRetry=null,t.prototype._onParentReady=null,t.prototype.resetOriginsForPosting=function(){return this._trustedChildOriginForPosting=null,this._trustedParentOriginForPosting=null},t.prototype.configureChildMessaging=function(t,r,e){return this._childIframeQuery=t,this._trustedChildOriginForPosting=null,this._validActionsFromChild=e,this._trustedMessageFromChildHandler=r},t.prototype.configureParentMessaging=function(t,r,e){return null==e&&(e=null),this._trustedParentOriginForPosting=null,this._validActionsFromParent=r,this._trustedMessageFromParentHandler=t,this._onParentReady=e},t.prototype.startListening=function(){return window.addEventListener("message",this.handleUntrustedMessage),null!=this._validActionsFromParent&&this._validActionsFromParent.length>0&&null!=this._trustedMessageFromParentHandler&&this._requestParentOrigin(),null!=this._validActionsFromChild&&this._validActionsFromChild.length>0&&null!=this._trustedMessageFromChildHandler?this.postMessageToChildren("parent-ready"):void 0},t.prototype.stopListening=function(){return window.removeEventListener("message",this.handleUntrustedMessage)},t.prototype._isNumber=function(t){return!isNaN(parseInt(t))},t.prototype._getOriginFromUrl=function(t){var r,e,i;return i=document.createElement("a"),i.href=t,r=this._isNumber(i.port)?":"+i.port:"",e="https://"+i.hostname+r},t.prototype._isChildOriginAllowed=function(t){return indexOf.call(this.constructor._ALLOWED_CHILD_ORIGINS,t)>=0||this._isDevVmOrigin(t)},t.prototype._isParentOriginAllowed=function(t){return indexOf.call(this.constructor._ALLOWED_PARENT_ORIGINS,t)>=0||this._isDevVmOrigin(t)},t.prototype._isDevVmOrigin=function(t){var r;return r=t.match(/\.dev\.corp\.dropbox(static|usercontent)?\.com($|:)/),(null!=r?r.length:void 0)>=1},t.prototype._validateChildOriginForPosting=function(t){var r;return r="null"===t?"*":this._getOriginFromUrl(t),"null"===t||this._isChildOriginAllowed(r)?(this._trustedChildOriginForPosting=r,!0):(console.warn("Untrusted message from child blocked: "+t),!1)},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._validateParentOriginForPosting=function(t){var r,e,i,n,o,s,l;if(s=this._trustedParentOriginForPosting,o=this._getOriginFromUrl(t),!this._isParentOriginAllowed(o))return console.warn("Untrusted message from parent blocked: "+t),!1;if(this._trustedParentOriginForPosting=o,this._parentMessageQueue.length>0){for(l=this._parentMessageQueue,r=0,e=l.length;e>r;r++)i=l[r],n=JSON.parse(i),this.postMessageToParent(n.action,n.parameters);this._parentMessageQueue=[]}return null!=this._trustedParentOriginForPosting&&null==s&&null!=this._onParentReady&&this._onParentReady(),!0},t.prototype.handleUntrustedMessage=function(t){var r,e,i,n,o;if(!this._isChildOriginAllowed(t.origin)&&!this._isParentOriginAllowed(t.origin))return void console.warn("Message received not in parent or child origin whitelist: "+t.origin);try{i=JSON.parse(t.data)}catch(e){return void(r=e)}if(null!=i.action)return"child-requesting-parent-origin"===i.action?void(this._validateChildOriginForPosting(t.origin)&&this.postMessageToChildren("parent-ready")):"parent-ready"===i.action?void this._validateParentOriginForPosting(t.origin):(n=i.action,indexOf.call(this._validActionsFromChild,n)>=0&&this._validateChildOriginForPosting(t.origin)&&null!=this._trustedMessageFromChildHandler?void this._trustedMessageFromChildHandler(i):(o=i.action,void(indexOf.call(this._validActionsFromParent,o)>=0&&this._validateParentOriginForPosting(t.origin)&&null!=this._trustedMessageFromParentHandler&&this._trustedMessageFromParentHandler(i))))},t.prototype._packagePostMessage=function(t,r){var e,i;return i=this.trustedChildOriginForPosting,e={action:t,parameters:r},JSON.stringify(e)},t.prototype.postMessageToChildElements=function(t,r,e){var i,n,o,s,l;if(null==e&&(e={}),null!=this.trustedChildOriginForPosting){for(s=this._packagePostMessage(r,e),l=[],i=0,o=t.length;o>i;i++)n=t[i],l.push(n.contentWindow.postMessage(s,this.trustedChildOriginForPosting));return l}},t.prototype.postMessageToChildren=function(t,r,e){var i;return null==r&&(r={}),null==e&&(e=null),null==e&&(e=this._childIframeQuery),i=document.querySelectorAll(e),this.postMessageToChildElements(i,t,r)},t.prototype.postMessageToParent=function(t,r){var e;return null==r&&(r={}),e=this._packagePostMessage(t,r),null==this.trustedParentOriginForPosting?void this._parentMessageQueue.push(e):window.parent.postMessage(e,this.trustedParentOriginForPosting)},t.prototype._requestParentOrigin=function(){var t;return window.parent.postMessage('{"action": "child-requesting-parent-origin"}',"*"),t=function(){return this._requestParentOriginPollRetry=null,null==this._trustedParentOriginForPosting?this._requestParentOrigin():void 0},setTimeout(t.bind(this),this._REQUEST_PARENT_ORIGIN_POLL_DELAY)},t}();
// @generated
